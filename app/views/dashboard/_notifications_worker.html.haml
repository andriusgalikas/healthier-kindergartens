.notification-box
  .row
    %span.panel-title
      = image_tag 'status-of-task.png'
      &nbsp;&nbsp;&nbsp;
      =t('dashboard.notifications.status_of_task')
  .row#notify_todos.panel-content
    %ul
      - User.self_available_todos.where(id: current_user.id).each do |todo|
        - todo_obj = Todo.find(todo.id)
        - if todo_obj.nil? && todo_obj.recurring_available
          - diff_time = get_remain_time(todo.id)
          - if (todo_obj.single? && diff_time[2] != -1 && diff_time[0] >= 0) || (todo_obj.recurring? && diff_time[0] != -1)
            %li
              = link_to todo_todo_completes_path(todo), method: :post, style: "color: #2f363d;text-decoration: none;" do
                %h5=todo.title
                .department-todo
                  .todo-command
                    .detail-box
                      - unless todo.iteration_type == 0
                        %ul#time-counter.time-counter
                          %li.days
                            %label=diff_time[0]
                            %span Days
                          %li.hours
                            %label=diff_time[1]
                            %span Hours
                          %li.minutes
                            %label=diff_time[2]
                            %span Mins
                        - percent = get_current_status(todo.id, current_user.department_id)
                        .progress
                          .value{style: "width: #{percent}%;"}
                      - else
                        %ul#time-counter.time-counter
                          %li.days
                            %label -
                            %span Days
                          %li.hours
                            %label -
                            %span Hours
                          %li.minutes
                            %label -
                            %span Mins                      
                  %span.todo-footer
                    = current_user.department.name

.notification-box
  .row
    %span.panel-title{id: 'item_nofity_message'} 
      = image_tag 'message-md.png'
      =t('dashboard.notifications.messages')
  .row.panel-content  
    .row.item-content
      - @notifications_by_sender.each do |sender|
        - index = 0
        - notif_per_source_type(@notifications, 'Message').each do |notif|    
          - unless notif.source_owner.nil? || index > 0
            .col-md-2.col-sm-3.col-xs-3.text-center
              %span.item-number 
                = sender.count_message
                - index = index + 1
            .col-md-10.col-sm-9.col-xs-9.no-h-padding
              = link_to list_messages_path(role: current_user.role, list_type: 'received', notification_id: notif.id)  do
                %span.item-description 
                  = notif_sender_name(notif)
:javascript
  jQuery(document).ready(function() {
    setInterval(function(){
      jQuery('.time-counter').each(function(){
        var days, hours, minutes;
        days = jQuery(this).children('.days').children('label').text();
        hours = jQuery(this).children('.hours').children('label').text();
        minutes = jQuery(this).children('.minutes').children('label').text();

        if (minutes == '-') return;

        minutes--;
        if(minutes < 0){
          minutes = 59;
          hours--;
        }

        if(hours < 0){
          hours = 23;
          days--;
        }

        if(days < 0){
          days = hours = minutes = 0;
        }

        jQuery(this).children('.days').children('label').text(days);
        jQuery(this).children('.hours').children('label').text(hours);
        jQuery(this).children('.minutes').children('label').text(minutes);        

      });
    }, 1000*60);
  });        